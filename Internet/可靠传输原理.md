## 可靠传输原理

### 流水线可靠数据传输协议

- 增加序号范围
- 协议的发送方和接收方两端需要缓存分组。(发送方最低限度应当能缓冲那些已经发送但是没有被确认的分组，接收方需要缓存那些已正确接收的分组)

### 回退N步(GBN)滑动窗口协议

- GBN 发送方需要响应的三种类型的事件：
  1. 上层的调用: 发送方需要检查发送窗口是否已满，既是否有 N 个已发送但未被确认的分组。
  2. 收到一个 ACK: GBN 协议中，对序号为N的分组的确认采取**累积确认**的方式，表明接收方已正确接收到序号为 N 的以前且包括 N 在内的所有的分组
  3. 超时事件: 如果出现超时，发送方重传所有已发送但还未被确认过的分组。(只采用了一个定时器，在 base 处)
- GBN 接收方：
  如果一个序号为 N 的分组被正确接收，并且按序(既上一次交付给上层的数据是序号为 N - 1 的分组),则接收方为分组 N 发送一个 ACK ，并将该分组中的数据部分交付给上层。在所有其他情况下，接收方丢弃该分组，并为最近按序接收的分组重新发送 ACK 。
  (接收方不需要缓存任何失序分组。因为发送方会重传所有已发送但还未被确认过的分组)

### 选择重传(SR)

当窗口长度和时延带宽积都很大的时候，在流水线中会有很多分组更是如此。单个分组的差错就能够引起 GBN 重传大量分组，很多分组根本没必要重传。
选择重传协议通过让发送方仅重传那些它怀疑在接收方出错的分组而避免了不必要的重传。

- SR 发送方的事件和动作：

1. 从上层收到数据：发送方需要检查发送窗口是否已满，既是否有N个已发送但未被确认的分组。
2. 收到 ACK : 如果收到 ACK ，倘若该分组序号在窗口内，则 SR 发送方将那个被确认的分组标记为已接受。如果该分组的序号等于 send_base ，则窗口基序号向前移动到具有最小序号的未确认分组处。
3. 超时事件：每个分组都必须拥有其自己的逻辑定时器。

- SR接收方的事件和动作：

1. 序号在 [ rcv_base, rcv_base + N - 1 ] 内的分组被正确接受。在此情况下，收到的分组落在接收方的窗口内，一个选择 ACK 被回送给发送方。如果该分组以前没收到过，则缓存该分组。如果该分组的序号等于接受窗口的基序号，则该分组以及以前缓存的序号连续的分组交付给上层。然后接受窗口按向前移动分组的编号向上交付这些分组。
2. 序号在 [ rcv_base - N, rcv_base - 1 ] 内的分组被正确接收到。在此情况下，必须产生一个 ACK ，即使该分组是接收方以前已确认过的分组。
3. 其他情况，忽略该分组。

- 窗口长度必须小于等于序号空间大小的一半